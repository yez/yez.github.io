<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <meta name="description" content="Using Strong Params in Rails 4.0 is a great way to acheive data consistency and real parameter validation.">
  

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      How to use Rails Strong Parameters &middot; A Year of Commits
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/share.css">
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/poole.css">
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/syntax.css">
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://jakeyesbeck.com/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="http://jakeyesbeck.com/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h2 class='h1'>
        <a href="http://jakeyesbeck.com">
          A Year of Commits
        </a>
      </h2>
      <p class="lead">The rantings of a man looking for inspiration. Embarking on a 365 day adventure of writing code. It might be funny or it might be sad, only time will tell.
</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="http://jakeyesbeck.com">Home</a>
      <a class="sidebar-nav-item" href="/archives">Archives</a>
      <a class="sidebar-nav-item" href="/about">About</a>
      <a class="sidebar-nav-item" href="https://github.com/yez">GitHub</a>
      <a class="sidebar-nav-item" href="https://twitter.com/jakeyesbeck">Twitter</a>
      <a class="sidebar-nav-item" href="/atom.xml">Feed</a>
    </nav>

    <p class='copyright'>&copy; 2016. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">How to use Rails Strong Parameters</h1>
  <span class="post-date">06 Dec 2015</span>
  
  <span class='share-container'><ul class="share-buttons">
  <li>
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://jakeyesbeck.com/2015/12/06/how-to-use-rails-strong-parameters/&t=How to use Rails Strong Parameters" title="Share on Facebook" target="_blank">
      <img src="http://jakeyesbeck.com/assets/images/facebook.svg">
    </a>
  </li>
  <li>
    <a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fjakeyesbeck.com&text=How to use Rails Strong Parameters%20http://jakeyesbeck.com/2015/12/06/how-to-use-rails-strong-parameters/&via=jakeyesbeck" target="_blank" title="Tweet">
      <img src="http://jakeyesbeck.com/assets/images/twitter.svg">
    </a>
  </li>
  <li>
    <a href="https://plus.google.com/share?url=http://jakeyesbeck.com/2015/12/06/how-to-use-rails-strong-parameters/" target="_blank" title="Share on Google+">
      <img src="http://jakeyesbeck.com/assets/images/google_plus.svg">
    </a>
  </li>

  <li>
    <a href="https://news.ycombinator.com/submitlink?u=http://jakeyesbeck.com/2015/12/06/how-to-use-rails-strong-parameters/&t=How to use Rails Strong Parameters" target="_blank" title="Share on Hacker News">
      <img src="http://jakeyesbeck.com/assets/images/ycomb.svg">
    </a>
  </li>

  <li>
    <a href="https://getpocket.com/save?url=http://jakeyesbeck.com/2015/12/06/how-to-use-rails-strong-parameters/&title=How to use Rails Strong Parameters" target="_blank" title="Add to Pocket">
      <img src="http://jakeyesbeck.com/assets/images/pocket.svg">
    </a>
  </li>
  <li>
    <a href="http://www.reddit.com/submit?url=http://jakeyesbeck.com/2015/12/06/how-to-use-rails-strong-parameters/&title=How to use Rails Strong Parameters" target="_blank" title="Submit to Reddit">
      <img src="http://jakeyesbeck.com/assets/images/reddit.svg">
    </a>
  </li>
</ul>
</span>
  <p>In the latest major version of Ruby on Rails, <strong>Strong Parameters</strong> were introduced. The intent of this addition was to enable consistent and reliable parameter checking. Using Strong Parameters is simple and intuitive. It provides a very clean method API to help keep controllers DRY.</p>

<p>However, knowing when to use Strong Parameters and how to use them correctly is very important. After all, what good is parameter validation if it is in the wrong place or conveys the wrong message?</p>

<h2>Hit the Books</h2>

<p>The trusty <em>&quot;booksandreviews.com&quot;</em> will serve as a good example application.</p>

<p>Given a controller that can create <code>Authors</code>, a default pattern without Strong Parameters could look like:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AuthorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># POST /authors</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@author</span> <span class="o">=</span> <span class="no">Author</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">author_params</span><span class="p">)</span>

    <span class="n">redirect_to</span> <span class="vi">@author</span><span class="p">,</span> <span class="ss">notice</span><span class="p">:</span> <span class="s1">&#39;Author was successfully created.&#39;</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">author_params</span>
    <span class="n">params</span><span class="o">[</span><span class="ss">:author</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Assuming that there are no presence validations on the <code>Author</code> class itself (or in the form view creating this model), this code has no check to make sure that anything about an <code>Author</code> is passed in to create.</p>

<p>This means that any <code>POST</code> request is made to <code>/authors</code> will create a new <code>Author</code>. While this kind of problem would most likely not make it to production, let us assume that the poor people over at &quot;booksandreviews.com&quot; came from such humble code beginnings that this <strong>was</strong> the first iteration of the <code>AuthorsController</code>.</p>

<p>To make the <code>AuthorsController</code> more robust, the <code>require</code> method can be used on the <code>params</code> hash:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AuthorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># ...</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">author_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:author</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Now if a <code>POST</code> to <code>/authors</code> does not contain a payload with an <code>:author</code> key in the body, the request will error:</p>

<p><code>ActionController::ParameterMissing</code></p>

<p>However, a request with the <code>:author</code> attribute will...</p>

<p><code>ActiveModel::ForbiddenAttributesError</code> <em>Also</em> cause an error, apparently.</p>

<p>This is another feature of Strong Parameters. The reason an error occurs is that the <code>author_params</code> method did not specify which parameters could be mass assigned to the <code>Author</code> class. Passing the result of <code>require</code> directly to <code>Author.create</code> will trip this safety measure.</p>

<h2>Shut &#39;em Down</h2>

<p>To correct the <code>ForbiddenAttributesError</code> and add some much needed structure to the <code>AuthorsController</code>, the <code>permit</code> method needs to be used in conjunction with <code>require</code>.</p>

<p>Adding a list of attributes as individual symbols will make sure that only those attributes can be passed through to <code>Author.create!</code></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AuthorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># ...</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">author_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:author</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:country</span><span class="p">,</span> <span class="ss">:email</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Great! Now a properly formatted <code>POST</code> containing only the correct attributes will create an <code>Author</code> appropriately.</p>

<p>But, why go through all the hassle? There should be a way to let all attributes pass, regardless of how crazy harmful they could be to our application we use to pay bills.</p>

<p>The <code>permit!</code> method is a completely permissive way to allow all attributes to be mass assigned to a model:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AuthorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># ...</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">author_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:author</span><span class="p">)</span><span class="o">.</span><span class="n">permit!</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>This will allow any attributes nested under <code>:author</code> to be set on an <code>Author</code>. A solution like this requires no declaration of attributes, but is this better?</p>

<p>The short answer is <em>&quot;no&quot;</em>.</p>

<p>The reason why being completely permissive with parameters is a bad idea is because not all attributes were created equally.</p>

<p>If <em>&quot;booksandreviews.com&quot;</em> had an <code>admin</code> or <code>superuser</code> column on their <code>authors</code> table, any <code>POST</code> with <code>admin: true</code> would create not a normal <code>Author</code>, but an all-mighty <code>Author</code>.</p>

<p>Specifying the attributes that can be mass assigned to an <code>ActiveRecord</code> model is not a new concept, with Strong Parameters this pattern is just too easy not to do.</p>

<h2>Open Up Shop</h2>

<p>Another great feature of using Strong Parameters is type assertion. Regardless of <code>ActiveRecord</code>&#39;s type coercion, ensuring that data is as valid as early as possible is important.</p>

<p>Consider that an <code>Author</code> can have an array of <code>genres</code> which summarize their bodies of work. To ensure that this list of <code>genres</code> is an array, a hash syntax can be used:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AuthorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># ...</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">author_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:author</span><span class="p">)</span>
          <span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:country</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="p">{</span> <span class="ss">genres</span><span class="p">:</span> <span class="o">[]</span> <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>By adding <code>{ genres: [] }</code> to the end of the <code>permit</code> call, it ensures that the <code>genres</code> value is always an array. This prevents random nonsense or a malformed request from compromising the <code>Author</code> class&#39; data integrity. If something other than an array is passed as the <code>genres</code> attribute, it will disregard it.</p>

<p>Alternatively, when a parameter is a hash (like <code>preferences</code>), all the keys in the hash need to be present in the <code>permit</code> call.</p>
<div class="highlight"><pre><code class="language-JSON" data-lang="JSON"><span class="p">{</span>
  <span class="nt">&quot;preferences&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;time_zone&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT&quot;</span><span class="p">,</span>
    <span class="nt">&quot;subscribed&quot;</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AuthorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># ...</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">author_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:author</span><span class="p">)</span>
          <span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span>
                  <span class="ss">:country</span><span class="p">,</span>
                  <span class="ss">:email</span><span class="p">,</span>
                  <span class="p">{</span> <span class="ss">preferences</span><span class="p">:</span> <span class="o">[</span><span class="ss">:time_zone</span><span class="p">,</span> <span class="ss">:subscribed</span><span class="o">]</span> <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>If this is a tad confusing, check out more examples at the <a href="http://edgeguides.rubyonrails.org/action_controller_overview.html#strong-parameters">official guide for Strong Parameters</a>.</p>

<h2>Everything in Moderation</h2>

<p>Strong Parameters is not appropriate for every situation. In the case that a certain number of parameters must be present, or if one parameter must only be present when not accompanied by another specific parameter, Strong Parameters will fall short. The time and place to use Strong Parameters is when creating or updating an <code>ActiveRecord</code> object.</p>

<p>Additionally, if the Ruby on Rails application in question was an API, Strong Parameters would only be effective in very specific circumstances. Since the feedback given by Strong Parameters is not as granular as an API would like to be, it could be hard to find many uses of it.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/12/20/rails-5-attributes/">
            Introduction to Rails 5 Attributes
            <small>20 Dec 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/11/15/five-active-record-features-you-should-be-using/">
            Five Active Record Features You Should Be Using
            <small>15 Nov 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/09/20/rails-http-status-codes/">
            Just learn Rails (Part 3) HTTP status codes
            <small>20 Sep 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62292380-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>

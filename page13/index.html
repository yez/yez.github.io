<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <meta name="description" content="Jake Yesbeck's Technology Blog inspired by Open Source Projects.">
  

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      A Year of Commits
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/compiled.css">
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://jakeyesbeck.com/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="http://jakeyesbeck.com/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h2 class='h1'>
        <a href="http://jakeyesbeck.com">
          A Year of Commits
        </a>
      </h2>
      <p class="lead">Jake Yesbeck's blog consisting of technical solutions, opinions about life, and updates on "A Year of Commits".
</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="http://jakeyesbeck.com">Home</a>
      <a class="sidebar-nav-item" href="/archives">Archives</a>
      <a class="sidebar-nav-item" href="http://jakeyesbeck.com/assets/files/yesbeckResume2018.pdf">Resume</a>
      <a class="sidebar-nav-item" href="/about">About</a>
      <a class="sidebar-nav-item" href="https://github.com/yez">GitHub</a>
      <a class="sidebar-nav-item" href="https://twitter.com/jakeyesbeck">Twitter</a>
      <a class="sidebar-nav-item" href="/atom.xml">Feed</a>
    </nav>

    <p class='copyright'>&copy; Jake Yesbeck 2020. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/02/28/ruby-spaceship-operator/">
        Ruby Spaceship <=> Operator
      </a>
    </h1>

    

    <span class="post-date">28 Feb 2016</span>
    <span class='share-container'><ul class="share-buttons">
  <li>
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://jakeyesbeck.com/2016/02/28/ruby-spaceship-operator/&t=Ruby Spaceship <=> Operator" title="Share on Facebook" target="_blank">
      <img src="http://jakeyesbeck.com/assets/images/facebook.svg">
    </a>
  </li>
  <li>
    <a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fjakeyesbeck.com&text=Ruby Spaceship <=> Operator%20http://jakeyesbeck.com/2016/02/28/ruby-spaceship-operator/&via=jakeyesbeck" target="_blank" title="Tweet">
      <img src="http://jakeyesbeck.com/assets/images/twitter.svg">
    </a>
  </li>
  <li>
    <a href="https://plus.google.com/share?url=http://jakeyesbeck.com/2016/02/28/ruby-spaceship-operator/" target="_blank" title="Share on Google+">
      <img src="http://jakeyesbeck.com/assets/images/google_plus.svg">
    </a>
  </li>

  <li>
    <a href="https://news.ycombinator.com/submitlink?u=http://jakeyesbeck.com/2016/02/28/ruby-spaceship-operator/&t=Ruby Spaceship <=> Operator" target="_blank" title="Share on Hacker News">
      <img src="http://jakeyesbeck.com/assets/images/ycomb.svg">
    </a>
  </li>

  <li>
    <a href="https://getpocket.com/save?url=http://jakeyesbeck.com/2016/02/28/ruby-spaceship-operator/&title=Ruby Spaceship <=> Operator" target="_blank" title="Add to Pocket">
      <img src="http://jakeyesbeck.com/assets/images/pocket.svg">
    </a>
  </li>
  <li>
    <a href="http://www.reddit.com/submit?url=http://jakeyesbeck.com/2016/02/28/ruby-spaceship-operator/&title=Ruby Spaceship <=> Operator" target="_blank" title="Submit to Reddit">
      <img src="http://jakeyesbeck.com/assets/images/reddit.svg">
    </a>
  </li>
</ul>
</span>

    <p>Adhering to the law of trichotomy, the <code class="highlighter-rouge">&lt;=&gt;</code> operator (sometimes called the “Spaceship Operator”) works by comparing two elements and returning a <code class="highlighter-rouge">-1</code>, <code class="highlighter-rouge">0</code>, or <code class="highlighter-rouge">1</code>. While the original mathematical criteria applies to only real numbers, many programming languages implement the law of trichotomy as a general comparison between equivalent types.</p>

<h2 id="basics">Basics</h2>

<p>At first glance, the return value of the <code class="highlighter-rouge">&lt;=&gt;</code> operator can be a bit confusing. A simple way to remember the significance of these return values is to break an expression down from left to right:</p>

<h3 id="section">1. <code class="highlighter-rouge">&lt;</code> –&gt; <code class="highlighter-rouge">-1</code></h3>
<p>if <code class="highlighter-rouge">a &lt; b</code>, then <code class="highlighter-rouge">-1</code> is returned</p>

<h3 id="section-1">2. <code class="highlighter-rouge">=</code> –&gt; <code class="highlighter-rouge">0</code></h3>
<p>if <code class="highlighter-rouge">a = b</code>, then <code class="highlighter-rouge">0</code> is returned</p>

<h3 id="section-2">3. <code class="highlighter-rouge">&gt;</code> –&gt; <code class="highlighter-rouge">1</code></h3>
<p>if <code class="highlighter-rouge">a &gt; b</code>, then <code class="highlighter-rouge">1</code> is returned</p>

<p>Example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>
<span class="o">&gt;</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
<span class="c1"># =&gt; -1</span>

<span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
<span class="c1"># =&gt; 0</span>

<span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
<span class="c1"># =&gt; 1</span>
</code></pre>
</div>

<h2 id="sorting">Sorting</h2>

<p>The <code class="highlighter-rouge">&lt;=&gt;</code> operator can be used alone for comparison or its contract honored within a block following the <code class="highlighter-rouge">sort</code> method.</p>

<p>By default, the <code class="highlighter-rouge">&lt;=&gt;</code> operator behaves as described above:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">list</span><span class="p">.</span><span class="nf">sort</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span> <span class="p">}</span>
<span class="c1"># =&gt; [0, 1, 3, 3, 4, 8]</span>
</code></pre>
</div>

<p>Following this pattern, it is easy to sort a list in reverse by swapping operand positions:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">list</span><span class="p">.</span><span class="nf">sort</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">b</span> <span class="o">&lt;=&gt;</span> <span class="n">a</span> <span class="p">}</span>
<span class="c1"># =&gt; [8, 4, 3, 3, 1, 0]</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">sort</code> method is extendable beyond explicit use of the <code class="highlighter-rouge">&lt;=&gt;</code> operator. A block passed to <code class="highlighter-rouge">sort</code> must only return either <code class="highlighter-rouge">-1</code>, <code class="highlighter-rouge">0</code>, or <code class="highlighter-rouge">1</code> for sorting to work effectively.</p>

<p>If the same list were to be ordered in odds then evens:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">list</span><span class="p">.</span><span class="nf">sort</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">_</span><span class="o">|</span> <span class="n">a</span><span class="p">.</span><span class="nf">odd?</span> <span class="p">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="c1"># =&gt; [3, 3, 1, 4, 8, 0]</span>
</code></pre>
</div>

<p>Also, since <code class="highlighter-rouge">-1</code>, <code class="highlighter-rouge">0</code>, and <code class="highlighter-rouge">1</code> are simple integers, creating compound <code class="highlighter-rouge">&lt;=&gt;</code> blocks is possible. If the same list were to be sorted odds then evens, with all odd and even numbers sorted in ascending order, it might look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">list</span><span class="p">.</span><span class="nf">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">a</span><span class="p">.</span><span class="nf">odd?</span>
    <span class="k">if</span> <span class="n">b</span><span class="p">.</span><span class="nf">odd?</span>
      <span class="c1"># both are odd, default &lt;=&gt; behaviour is used</span>
      <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
    <span class="k">else</span>
      <span class="o">-</span><span class="mi">1</span> <span class="c1"># a &lt; b</span>
    <span class="k">end</span>
  <span class="k">else</span> <span class="c1"># a is even</span>
    <span class="k">if</span> <span class="n">b</span><span class="p">.</span><span class="nf">even?</span>
      <span class="c1"># both are even, default &lt;=&gt; behaviour is used</span>
      <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
    <span class="k">else</span>
      <span class="mi">1</span> <span class="c1"># a &gt; b</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="c1"># =&gt; [1, 3, 3, 0, 4, 8]</span>
</code></pre>
</div>

<p>Far from elegant, this code effectively sorts the array of numbers first by odds to evens and then in ascending order.</p>

<h2 id="custom-methods">Custom Methods</h2>

<p>While thought of and generally referred to as an operator, <code class="highlighter-rouge">&lt;=&gt;</code> is actually a method. Defined originally on <code class="highlighter-rouge">Object</code>, any object has the opportunity to redefine this method to achieve custom sort behaviour.</p>

<p>An example class, <code class="highlighter-rouge">Node</code>, has a single attribute <code class="highlighter-rouge">value</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Node</span>
  <span class="kp">attr_accessor</span> <span class="ss">:value</span>
<span class="k">end</span>
</code></pre>
</div>

<p>By default, sorting an array of <code class="highlighter-rouge">Node</code> objects does not produce the desired result:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">node1</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span>
<span class="n">node1</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">node2</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span>
<span class="n">node2</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">node3</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span>
<span class="n">node3</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">]</span>
<span class="n">list</span><span class="p">.</span><span class="nf">sort</span>

<span class="c1"># =&gt; ArgumentError: comparison of Node with Node failed</span>
</code></pre>
</div>

<p>However, with a custom <code class="highlighter-rouge">&lt;=&gt;</code> method:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Node</span>
  <span class="kp">attr_accessor</span> <span class="ss">:value</span>

  <span class="k">def</span> <span class="nf">&lt;</span><span class="o">=&gt;</span><span class="p">(</span><span class="n">other_node</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">value</span> <span class="o">&lt;=&gt;</span> <span class="n">other_node</span><span class="p">.</span><span class="nf">value</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">]</span>
<span class="n">list</span><span class="p">.</span><span class="nf">sort</span>
<span class="c1"># =&gt; [#&lt;Node: @value=10&gt;, #&lt;Node: @value=20&gt;, #&lt;Node: @value=30&gt;]</span>
</code></pre>
</div>

<p>Boom! Custom sorting in the mix!</p>

<p>Admittedly, this same behaviour is possible with the built in <code class="highlighter-rouge">sort_by</code> method:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">]</span>
<span class="n">list</span><span class="p">.</span><span class="nf">sort_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:value</span><span class="p">)</span>

<span class="c1"># =&gt; [#&lt;Node: @value=10&gt;, #&lt;Node: @value=20&gt;, #&lt;Node: @value=30&gt;]</span>
</code></pre>
</div>

<p>But, what happens when the <code class="highlighter-rouge">Node</code> class wants to expose a sorting mechanism while removing its <code class="highlighter-rouge">value</code> method? In that case, the <code class="highlighter-rouge">sort_by</code> method would no longer be sufficient.</p>

<p>Defining a custom <code class="highlighter-rouge">&lt;=&gt;</code> method also allows objects to include the <code class="highlighter-rouge">Comparable</code> mixin effectively. The <code class="highlighter-rouge">Comparable</code> mixin provides the conventional comparison operators (<code class="highlighter-rouge">&lt;</code>, <code class="highlighter-rouge">&gt;</code>, <code class="highlighter-rouge">&lt;=</code>, etc.).</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Node</span>
  <span class="kp">include</span> <span class="no">Comparable</span>
  <span class="kp">attr_accessor</span> <span class="ss">:value</span>

  <span class="k">def</span> <span class="nf">&lt;</span><span class="o">=&gt;</span><span class="p">(</span><span class="n">other_node</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">value</span> <span class="o">&lt;=&gt;</span> <span class="n">other_node</span><span class="p">.</span><span class="nf">value</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">node1</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span>
<span class="n">node1</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="mi">200</span>

<span class="n">node2</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span>
<span class="n">node2</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">node1</span> <span class="o">&gt;</span> <span class="n">node2</span>
<span class="c1"># =&gt; false</span>

<span class="n">node1</span> <span class="o">&lt;</span> <span class="n">node2</span>
<span class="c1"># =&gt; true</span>

<span class="n">node3</span> <span class="o">=</span> <span class="no">Node</span><span class="p">.</span><span class="nf">new</span>
<span class="n">node3</span><span class="p">.</span><span class="nf">value</span> <span class="o">=</span> <span class="mi">250</span>

<span class="n">node3</span><span class="p">.</span><span class="nf">between?</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
<span class="c1"># =&gt; true</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">Comparable</code> mixin provides very useful functionality that can easily turn a custom class into a sortable list element. As with most patterns in software, using the right tool at the right time is very important. It may not always be appropriate to write a custom comparison mechanism for a class, but when it is, the collaboration of <code class="highlighter-rouge">&lt;=&gt;</code> and the <code class="highlighter-rouge">Comparable</code> mixin is worth evaluating.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="http://jakeyesbeck.com/page14">Older</a>
  
  
    
      <a class="pagination-item newer" href="http://jakeyesbeck.com/page12">Newer</a>
    
  
</div>

    </div>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62292380-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

  window.setTimeout(function() {
    ga('send', 'event', '10 seconds', 'passed')
  }, 30 * 1000);
</script>

  </body>
  <script src="//load.sumome.com/" data-sumo-site-id="c1ac0d77564d88e7bccc5e57a3839303fe48b17353cf42e4a295539de43b653b" async="async"></script>
  <script src="https://use.fontawesome.com/b3103405a3.js"></script>
</html>

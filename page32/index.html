<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
    <meta name="description" content="A technology blog about a Year of Commits to Open Source projects.">
  

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      A Year of Commits
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/share.css">
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/poole.css">
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/syntax.css">
  <link rel="stylesheet" href="http://jakeyesbeck.com/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://jakeyesbeck.com/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="http://jakeyesbeck.com/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h2 class='h1'>
        <a href="http://jakeyesbeck.com">
          A Year of Commits
        </a>
      </h2>
      <p class="lead">Jake Yesbeck's blog consisting of technical solutions, opinions about life, and updates on "A Year of Commits".
</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="http://jakeyesbeck.com">Home</a>
      <a class="sidebar-nav-item" href="/archives">Archives</a>
      <a class="sidebar-nav-item" href="/about">About</a>
      <a class="sidebar-nav-item" href="https://github.com/yez">GitHub</a>
      <a class="sidebar-nav-item" href="https://twitter.com/jakeyesbeck">Twitter</a>
      <a class="sidebar-nav-item" href="/atom.xml">Feed</a>
    </nav>

    <p class='copyright'>&copy; Jake Yesbeck 2016. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/07/19/just-learn-rails-part-2/">
        Just learn Rails (Part 2)
      </a>
    </h1>

    

    <span class="post-date">19 Jul 2015</span>
    <span class='share-container'><ul class="share-buttons">
  <li>
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://jakeyesbeck.com/2015/07/19/just-learn-rails-part-2/&t=Just learn Rails (Part 2)" title="Share on Facebook" target="_blank">
      <img src="http://jakeyesbeck.com/assets/images/facebook.svg">
    </a>
  </li>
  <li>
    <a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fjakeyesbeck.com&text=Just learn Rails (Part 2)%20http://jakeyesbeck.com/2015/07/19/just-learn-rails-part-2/&via=jakeyesbeck" target="_blank" title="Tweet">
      <img src="http://jakeyesbeck.com/assets/images/twitter.svg">
    </a>
  </li>
  <li>
    <a href="https://plus.google.com/share?url=http://jakeyesbeck.com/2015/07/19/just-learn-rails-part-2/" target="_blank" title="Share on Google+">
      <img src="http://jakeyesbeck.com/assets/images/google_plus.svg">
    </a>
  </li>

  <li>
    <a href="https://news.ycombinator.com/submitlink?u=http://jakeyesbeck.com/2015/07/19/just-learn-rails-part-2/&t=Just learn Rails (Part 2)" target="_blank" title="Share on Hacker News">
      <img src="http://jakeyesbeck.com/assets/images/ycomb.svg">
    </a>
  </li>

  <li>
    <a href="https://getpocket.com/save?url=http://jakeyesbeck.com/2015/07/19/just-learn-rails-part-2/&title=Just learn Rails (Part 2)" target="_blank" title="Add to Pocket">
      <img src="http://jakeyesbeck.com/assets/images/pocket.svg">
    </a>
  </li>
  <li>
    <a href="http://www.reddit.com/submit?url=http://jakeyesbeck.com/2015/07/19/just-learn-rails-part-2/&title=Just learn Rails (Part 2)" target="_blank" title="Submit to Reddit">
      <img src="http://jakeyesbeck.com/assets/images/reddit.svg">
    </a>
  </li>
</ul>
</span>

    <p>In a <a href="http://jakeyesbeck.com/2015/05/17/just-learn-rails/">previous post</a> I explained how <em>“just learning Rails”</em> is not as straight forward as the phrase portrays. Even the novice programmer who learns Ruby on Rails in a methodical progression may still run into hardship. However, this is not entirely the fault of young programmer, he or she was simply enabled into bad habits. <strong>Ruby on Rails enables the complete disregard of encapsulation.</strong> Notice how I did not say that Ruby on Rails prescribes less encapsulation, it simply enables it.</p>

<p>This idea, much like any idea posted to the Internet, is not new. Many intelligent people have come to this same realization. One such example is the <a href="https://github.com/apotonick/trailblazer">Trailblazer framework</a>, which aims to help inject some encapsulation and abstraction mechanisms Rails is lacking. (For those interested, <a href="https://leanpub.com/trailblazer">a book has been written</a> to more fully explain this framework).</p>

<p>Alright, so what am I really talking about? Ruby on Rails has certain features that make it easy to forget about encapsulation.</p>

<h3 id="the-autoloader">The Autoloader</h3>

<p>A keyword that most Ruby on Rails developers rarely see on a daily basis is <code class="highlighter-rouge">require</code>. A piece of Ruby on Rails magic called <a href="http://guides.rubyonrails.org/autoloading_and_reloading_constants.html">autoloading</a> greatly decreased the frequency of the <code class="highlighter-rouge">require</code> keyword in Ruby on Rails applications. This has many positive aspects for new and seasoned developers alike. But, it is not without drawbacks. One such drawback is that it makes <code class="highlighter-rouge">ActiveRecord</code> objects ubiquitous. Whenever a developer has the urge to reach into the database, regardless of the context, they are able to do so.</p>

<p><strong>This enables horrific code.</strong></p>

<p>Imagine we have a view template that we want to display a user’s username and their pictures. Without any guidance, this following code could come into existence:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#
# Reminder, this is terrible code. Never do this.
#

<span class="nt">&lt;div&gt;</span>
  <span class="c">&lt;!--
    Let's just go through all the users in the database.
    This is a new application so we don't have that many users,
     it will never run into scalability issues.
     --&gt;</span>
  <span class="cp">&lt;%</span> <span class="no">User</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'username'</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">user</span><span class="p">.</span><span class="nf">username</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'pictures'</span><span class="nt">&gt;</span>
      <span class="c">&lt;!--
       Make sure we have the only the picture url, just go ahead
        directly to the database and let it handle
        the downcasing that we, for some reason, need.
       Also, Jim in Business Ops thinks it will be
        super great to order the pictures randomly each time!
      --&gt;</span>
      <span class="cp">&lt;%</span> <span class="no">Pictures</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="s1">'downcase(url)'</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">user_id: </span><span class="n">user</span><span class="p">.</span><span class="nf">id</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="s1">'random()'</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">url</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">url</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">/&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

#
# Never replicate the above code or you will be very sad
#
</code></pre>
</div>

<p>Notice how deep in the presentation layer (the view) we have direct database calls. This completely violates the encapsulations that an MVC framework should provide. Since all the models exist everywhere, nothing stops a programmer from writing it in this way. The code above should make every ruby programmer cringe.</p>

<p>Separating concerns and responsibilities helps prevent repetition and boosts comprehension. The above code should be a composition of multiple objects with entirely different responsibilities. That concept is not always intuitive for some developers, especially those just starting out. One might ask: <em>“Why would I make a whole mess of objects to do the same thing that these 14 lines can do?”</em>. The simple answer is because these problems are not new. Ruby on Rails did not expose these abstraction and encapsulation issues for the first time in the history of software engineering. They have been around for <a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)">a very long time</a>. Smarter software artisans than I saw these problems and created guidelines to solve them. Following their lead will save all of us in the long run.</p>

<p>So what can we do about our misguided code above? Let us try moving some responsibilities around and see how it changes.</p>

<h3 id="add-a-dash-of-encapsulation">Add a dash of encapsulation</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># The user class just needs to know about the database connection.</span>
<span class="c1"># ActiveRecord takes care of that detail for us, adding a scope</span>
<span class="c1">#   is a supplementary addition to that logic.</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">scope</span> <span class="ss">:with_pictures</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">includes</span><span class="p">(</span><span class="ss">:pictures</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># We can create a PORO (Plain Old Ruby Object) to house the user</span>
<span class="c1">#  object and extract, downcase, and randomize its picture urls.</span>
<span class="k">class</span> <span class="nc">UserPresenter</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="vi">@pictures</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">pictures</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">username</span>
    <span class="vi">@user</span><span class="p">.</span><span class="nf">username</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">picture_urls</span>
    <span class="vi">@pictures</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">photo</span><span class="o">|</span>
      <span class="n">photo</span><span class="p">.</span><span class="nf">url</span><span class="p">.</span><span class="nf">downcase</span>
    <span class="k">end</span><span class="p">.</span><span class="nf">shuffle</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># The controller handles linking up each User with a UserPresenter</span>
<span class="c1">#  then saves the list to a variable to be used by the view.</span>
<span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ActionController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@user_presenters</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="no">User</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">with_pictures</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
      <span class="vi">@user_presenters</span> <span class="o">&lt;&lt;</span> <span class="no">UserPresenter</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Finally, the view logic only knows about a presenter for each user. From the views perspective, the presenter object only has two methods: username and picture_urls. It does not need to know about database structure, schema, syntax or business logic. It has one job, to display data:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@user_presenters</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">presenter</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'username'</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">presenter</span><span class="p">.</span><span class="nf">username</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'pictures'</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%</span> <span class="n">presenter</span><span class="p">.</span><span class="nf">picture_urls</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">url</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">url</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">/&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>

<h3 id="conclusion">Conclusion</h3>

<p>The code that was rewritten is far from perfect. However, it is a noticeable improvement over its original version. I am in no way claiming to be the creator of these design patters, simply a spokesperson for good encapsulation and object oriented design. When respected and correctly utilized, Ruby on Rails is a fantastic tool for web development. When learning Ruby on Rails, it is imperative to stand by software engineering paradigms. Just because a framework allows it, doesn’t mean that it is necessarily a good thing to do.</p>


  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="http://jakeyesbeck.com/page33">Older</a>
  
  
    
      <a class="pagination-item newer" href="http://jakeyesbeck.com/page31">Newer</a>
    
  
</div>

    </div>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62292380-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>

  </body>
</html>
